/* ==================================================
   Sunset Aura Theme (Auto / Dark / Light)
   - Palette: warm coral/orange with soft rose highlights
   - Keeps --re-app-bg for correct light/dark background
   - Drop-in replacement for your original theme
   ================================================== */
:root,
:host {
  /* Palette (default: DARK) */
  --re-bg:             #140d0e; /* deep aubergine-brown */
  --re-surface:        #1a1214; /* inked plum */
  --re-surface-2:      #120a0c; /* near-black with warm tint */
  --re-elev:           #221519; /* raised card */
  --re-border:         #3a2730; /* warm mauve edge */
  --re-text:           #f6f3f4; /* near-white with warm bias */
  --re-text-muted:     #cdbcc0; /* muted rose-gray */
  --re-accent:         #fb923c; /* orange-400 */
  --re-accent-strong:  #f97316; /* orange-500 */
  --re-danger:         #ef4444; /* red-500 */
  --re-danger-700:     #b91c1c; /* red-700 */
  --re-ok:             #22c55e; /* green-500 */
  --re-focus:          #f59e0b; /* amber-500 */

  /* Radii & Shadows */
  --re-radius:         12px;
  --re-radius-sm:      10px;
  --re-shadow:         0 10px 30px rgba(0,0,0,0.38);
  --re-inset:          inset 0 1px 0 rgba(255,255,255,0.03);

  /* Typography */
  --re-font:           ui-sans-serif, -apple-system, Segoe UI, Roboto, Inter, Arial, system-ui, "Apple Color Emoji", "Segoe UI Emoji";
  --re-font-mono:      ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;

  /* Sizing */
  --re-maxw:           1200px;
  --re-sidebar-w:      320px;
  --re-gutter:         16px;

  /* App background token (DARK default) */
  --re-app-bg:
    radial-gradient(1000px 600px at -10% -20%, rgba(251,146,60,0.28) 0%, rgba(86,30,23,0.16) 35%, rgba(10,6,8,0) 60%),
    radial-gradient(700px 350px at 110% 110%, rgba(244,63,94,0.18) 0%, rgba(34,17,19,0.26) 45%, rgba(10,6,8,0) 60%),
    linear-gradient(180deg, #0a0607 0%, #1a1113 100%);
}

/* Explicit DARK mode */
:root[data-theme="dark"], :host([data-theme="dark"]) {
  --re-bg:#140d0e; --re-surface:#1a1214; --re-surface-2:#120a0c; --re-elev:#221519;
  --re-border:#3a2730; --re-text:#f6f3f4; --re-text-muted:#cdbcc0;
  --re-accent:#fb923c; --re-accent-strong:#f97316; --re-danger:#ef4444;
  --re-danger-700:#b91c1c; --re-ok:#22c55e; --re-focus:#f59e0b;
  --re-app-bg:
    radial-gradient(1000px 600px at -10% -20%, rgba(251,146,60,0.28) 0%, rgba(86,30,23,0.16) 35%, rgba(10,6,8,0) 60%),
    radial-gradient(700px 350px at 110% 110%, rgba(244,63,94,0.18) 0%, rgba(34,17,19,0.26) 45%, rgba(10,6,8,0) 60%),
    linear-gradient(180deg, #0a0607 0%, #1a1113 100%);
}

/* Explicit LIGHT mode */
:root[data-theme="light"], :host([data-theme="light"]) {
  --re-bg:#fff7ed; --re-surface:#ffffff; --re-surface-2:#fff1e6; --re-elev:#ffffff;
  --re-border:#f2dfd3; --re-text:#0f172a; --re-text-muted:#6c5a5b;
  --re-accent:#ea580c; --re-accent-strong:#c2410c; --re-danger:#dc2626;
  --re-danger-700:#991b1b; --re-ok:#16a34a; --re-focus:#f59e0b;
  /* LIGHT app background */
  --re-app-bg: linear-gradient(180deg, #ffffff 0%, #fff7ed 100%);
}

/* AUTO: system LIGHT (only when no data-theme is set) */
@media (prefers-color-scheme: light) {
  :root:not([data-theme]), :host(:not([data-theme])) {
    --re-bg:#fffaf5; --re-surface:#ffffff; --re-surface-2:#fff1e6; --re-elev:#ffffff;
    --re-border:#f2dfd3; --re-text:#0f172a; --re-text-muted:#6c5a5b;
    --re-accent:#ea580c; --re-accent-strong:#c2410c; --re-danger:#dc2626;
    --re-danger-700:#991b1b; --re-ok:#16a34a; --re-focus:#f59e0b;
    --re-app-bg: linear-gradient(180deg, #ffffff 0%, #fff7ed 100%);
  }
}

/* AUTO: system DARK (only when no data-theme is set) */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme]), :host(:not([data-theme])) {
    --re-bg: #120c0d;
    --re-surface: #181113;
    --re-surface-2: #100a0b;
    --re-elev: #201417;
    --re-border: #38242c;
    --re-text: #f6f3f4;
    --re-text-muted: #cdbcc0;
    --re-accent: #fb923c;
    --re-accent-strong: #f97316;
    --re-ok: #22c55e;
    --re-app-bg:
      radial-gradient(1000px 600px at -10% -20%, rgba(251,146,60,0.28) 0%, rgba(86,30,23,0.16) 35%, rgba(10,6,8,0) 60%),
      radial-gradient(700px 350px at 110% 110%, rgba(244,63,94,0.18) 0%, rgba(34,17,19,0.26) 45%, rgba(10,6,8,0) 60%),
      linear-gradient(180deg, #0a0607 0%, #1a1113 100%);
  }
}

/* ========================= Base ========================= */
.reverse-engineer-gui {
  box-sizing: border-box;
  color: var(--re-text);
  font-family: var(--re-font);
  background: var(--re-app-bg);
  min-height: 100vh;
  padding: clamp(12px, 2vw, 24px);
}

.re-gui-shell {
  max-width: var(--re-maxw);
  margin: 0 auto;
  display: grid;
  grid-template-rows: auto 1fr;
  gap: var(--re-gutter);
}

/* ===================== Header/Nav ====================== */
.re-gui-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  border: 1px solid var(--re-border);
  border-radius: var(--re-radius);
  box-shadow: var(--re-inset), var(--re-shadow);
  padding: 14px 16px;
}

.re-brand { display: flex; align-items: center; gap: 10px; }

.re-logo {
  width: 34px; height: 34px; display: inline-grid; place-items: center;
  background: linear-gradient(135deg, rgba(251,146,60,0.28), rgba(194,65,12,0.18));
  border: 1px solid var(--re-border); border-radius: 8px;
  color: var(--re-accent); font-weight: 700;
}

.re-title { font-size: 18px; line-height: 1.2; margin: 0; color: var(--re-text); letter-spacing: 0.2px; }

.re-actions { display: flex; gap: 8px; }

/* ===================== Main Layout ===================== */
.re-gui-main { display: grid; grid-template-columns: minmax(240px, var(--re-sidebar-w)) 1fr; gap: var(--re-gutter); }
@media (max-width: 900px) { .re-gui-main { grid-template-columns: 1fr; } }

/* ======================= Sidebar ======================= */
.re-sidebar { display: grid; grid-template-rows: auto 1fr; gap: var(--re-gutter); }

.re-search {
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  border: 1px solid var(--re-border);
  border-radius: var(--re-radius);
  padding: 12px;
  box-shadow: var(--re-inset), var(--re-shadow);
}

.re-search-input {
  width: 100%; background: var(--re-surface); color: var(--re-text);
  border: 1px solid var(--re-border); border-radius: 10px; padding: 10px 12px; outline: none;
}
.re-search-input:focus { border-color: var(--re-accent); box-shadow: 0 0 0 3px color-mix(in oklab, var(--re-accent) 35%, transparent); }

.re-list-wrap {
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  border: 1px solid var(--re-border); border-radius: var(--re-radius);
  box-shadow: var(--re-inset), var(--re-shadow);
  padding: 8px; min-height: 240px; display: grid; grid-template-rows: 1fr;
}

.re-algo-list { list-style: none; margin: 0; padding: 4px; overflow: auto; display: grid; gap: 6px; }

.re-empty { color: var(--re-text-muted); font-size: 14px; padding: 10px 12px; }

.re-algo-item {
  background: var(--re-surface); border: 1px solid var(--re-border); border-radius: 10px;
  padding: 10px 12px; cursor: pointer; outline: none;
  transition: transform 0.08s ease, border-color 0.15s ease, background 0.15s ease;
}
.re-algo-item:hover { border-color: var(--re-accent); background: color-mix(in oklab, var(--re-surface) 80%, var(--re-accent) 20%); }
.re-algo-item[aria-selected="true"] { background: linear-gradient(135deg, rgba(249,115,22,0.12), rgba(194,65,12,0.08)); border-color: var(--re-accent-strong); }
.re-algo-item:focus-visible { box-shadow: 0 0 0 3px color-mix(in oklab, var(--re-focus) 45%, transparent); }

/* ====================== Workspace ====================== */
.re-workspace { display: grid; gap: var(--re-gutter); align-content: start; }

.re-panel {
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  border: 1px solid var(--re-border); border-radius: var(--re-radius);
  box-shadow: var(--re-inset), var(--re-shadow); padding: 14px;
}

.re-panel-title { margin: 0 0 10px 0; font-size: 16px; color: var(--re-text); letter-spacing: 0.2px; display: flex; justify-content: space-between;}

.re-detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.re-col-span { grid-column: 1 / -1; }

.re-label { display: block; color: var(--re-text-muted); font-size: 12px; margin-bottom: 6px; }

.re-kv .re-value { color: var(--re-text); font-weight: 600; letter-spacing: 0.2px; }

/* ======================== Form ======================== */
.re-form { display: grid; gap: 14px; }
.re-field-row { display: grid; gap: 12px; }

.re-input { background: var(--re-surface); color: var(--re-text); border: 1px solid var(--re-border); border-radius: var(--re-radius-sm); padding: 10px 12px; outline: none; width: calc(100% - 30px); }
.re-input:focus { border-color: var(--re-accent); box-shadow: 0 0 0 3px color-mix(in oklab, var(--re-accent) 35%, transparent); }

.re-textarea { resize: vertical; min-height: 145px; }

/* ================ Segmented control =================== */
.re-seg { display: inline-flex; background: var(--re-surface); border: 1px solid var(--re-border); border-radius: 10px; overflow: hidden; }
.re-seg-item { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-right: 1px solid var(--re-border); cursor: pointer; user-select: none; }
.re-seg-item:last-child { border-right: none; }
.re-seg-item input { accent-color: var(--re-accent); }

.re-hint { color: var(--re-text-muted); font-size: 12px; margin: 6px 0 0 0; }

/* ======================= Buttons ====================== */
.re-btn { appearance: none; border: 1px solid var(--re-border); background: var(--re-surface); color: var(--re-text); padding: 10px 14px; border-radius: 10px; cursor: pointer; transition: transform 0.08s ease, border-color 0.15s ease, background 0.15s ease; }
.re-btn:hover { border-color: var(--re-accent); background: color-mix(in oklab, var(--re-surface) 85%, var(--re-accent) 15%); }
.re-btn:active { transform: translateY(1px); }
.re-btn:disabled { opacity: 0.5; cursor: not-allowed; }

.re-primary { background: linear-gradient(135deg, rgba(249,115,22,0.22), rgba(234,88,12,0.18)); border-color: var(--re-accent-strong); }
.re-secondary { background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); }
.re-danger { background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(185,28,28,0.15)); border-color: var(--re-danger-700); }

.re-actions-row { display: flex; gap: 8px; flex-wrap: wrap; }

/* ======================= Output ======================= */
.re-code { margin: 0; padding: 12px; background: var(--re-surface-2); border: 1px solid var(--re-border); border-radius: var(--re-radius-sm); color: var(--re-text); font-family: var(--re-font-mono); font-size: 13px; line-height: 1.5; overflow: auto; min-height: 90px; }
.re-code .re-code-content {text-wrap: auto;overflow-wrap: anywhere;}
/* =============== Accessibility focus ================== */
:where(.reverse-engineer-gui) :focus-visible { outline: 3px solid color-mix(in oklab, var(--re-focus) 45%, transparent); outline-offset: 2px; }

/* ===================== Small tweaks =================== */
code { font-family: var(--re-font-mono); color: var(--re-accent); }

/* ====== Icon-only Theme Toggle (sun/moon/auto) ======== */
.re-icon-btn { width: 38px; height: 38px; padding: 0; display: inline-grid; place-items: center; }
.re-icon { width: 18px; height: 18px; color: var(--re-text); }
.re-icon-btn:hover .re-icon { color: color-mix(in oklab, var(--re-text) 70%, var(--re-accent) 30%); }
.re-theme-toggle .icon-auto, .re-theme-toggle .icon-sun, .re-theme-toggle .icon-moon { display: none; }
.re-theme-toggle[data-mode="auto"]  .icon-auto { display: inline; }
.re-theme-toggle[data-mode="light"] .icon-sun  { display: inline; }
.re-theme-toggle[data-mode="dark"]  .icon-moon { display: inline; }

/* ====== Copy to clipboard ======== */
.re-copy.is-success{border: 1px solid #1f7a1f!important;}
.re-copy.is-success svg { color: #1f7a1f!important; }
.re-copy.is-error{border: 1px solid #b00020!important;}
.re-copy.is-error svg   { color: #b00020!important; }

/* ====== Footer ======== */
.re-footer {
  border-top: 1px solid var(--re-border, #e4e4e7);
  padding: .5rem .75rem;
  font-size: 14px;
  color: var(--re-muted-fg, #6b7280);
  background: var(--re-bg, #fff);
}

.re-footer a {
  color: inherit;
  text-decoration: underline;
}

/* ======== Sort bar ======== */
.reverse-engineer-gui .re-sortbar {
  display: flex; gap: .5rem; align-items: center; padding: .5rem .5rem 0;
}

.reverse-engineer-gui .re-group-header {
  font-weight: 600;
  opacity: .8;
  padding: .25rem .5rem;
  margin-top: .5rem;
  border-top: 1px dashed var(--re-border, currentColor);
}

/* ======= File Upload (theme-aware) ======= */
:where(.reverse-engineer-gui) {
  /* Local, theme-aware tokens for the file UI */
  --re-file-zone-bg:        var(--re-surface);
  --re-file-zone-bg-hover:  color-mix(in oklab, var(--re-surface) 85%, var(--re-accent) 15%);
  --re-file-zone-bg-drag:   color-mix(in oklab, var(--re-surface) 88%, var(--re-accent) 12%);
  --re-file-zone-border:    var(--re-border);
  --re-file-meta-bg:        var(--re-surface-2);
  --re-file-meta-border:    var(--re-border);
  --re-file-disabled-bg:    color-mix(in oklab, var(--re-surface) 92%, var(--re-bg) 8%);
  --re-file-disabled-border:var(--re-border);
  --re-file-ring:           color-mix(in oklab, var(--re-accent) 35%, transparent);
}

/* Keep input accessible to AT while visually hidden */
.re-file {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  border: 0 !important;
  overflow: hidden !important;
  clip: rect(0 0 0 0) !important;
  clip-path: inset(50%) !important;
  white-space: nowrap !important;
}

/* Wrapper and zone */
.re-file-wrap { display: grid; gap: .5rem; }

.re-file-zone {
  border: 2px dashed var(--re-file-zone-border);
  border-radius: .5rem;
  padding: 1rem;
  cursor: pointer;
  background: var(--re-file-zone-bg);
  outline: none;
  transition:
    border-color .15s ease,
    background .15s ease,
    box-shadow .15s ease;
  color: inherit; /* inherit themed text color */
}

.re-file-zone:hover,
.re-file-zone:focus {
  border-color: var(--re-accent);
  background: var(--re-file-zone-bg-hover);
  box-shadow: 0 0 0 3px var(--re-file-ring);
}

.re-file-zone.dragover {
  border-color: var(--re-accent);
  background: var(--re-file-zone-bg-drag);
}

/* Disabled state matches theme */
.re-file-zone[disabled],
.re-file-zone.is-disabled {
  opacity: .55;
  cursor: not-allowed;
  border-color: var(--re-file-disabled-border);
  background: var(--re-file-disabled-bg);
  pointer-events: none;
}

/* Inner content */
.re-file-zone-inner {
  display: flex;
  align-items: center;
  gap: .75rem;
  justify-content: center;
  text-align: center;
}
.re-file-icon { opacity: .8; }
.re-file-zone-text strong { display: block; }
.re-file-zone-or { opacity: .7; margin: 0 .35rem; }

/* Link that opens the native picker */
.re-link {
  background: none;
  border: 0;
  color: var(--re-accent);
  cursor: pointer;
  padding: 0;
  text-decoration: underline;
}

/* Selected file metadata chip */
.re-file-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border: 1px solid var(--re-file-meta-border);
  border-radius: .5rem;
  padding: .5rem .75rem;
  background: var(--re-file-meta-bg);
  color: inherit;
}

.re-file-info { display: flex; gap: .5rem; align-items: baseline; flex-wrap: wrap; }
.re-file-name { font-weight: 600; }
.re-file-size { opacity: .8; font-size: .9em; }

/* Small button size for “Remove” */
.re-btn.re-mini { font-size: .85em; padding: .25rem .5rem; }

/* ======= File error box (light/dark aware) ======= */

/* Optional micro-resets for the error box */
.re-file-error,
.re-file-error * {
  box-sizing: border-box;
}

/* Hidden state (mirrors your JS behavior) */
.re-file-error[hidden] {
  display: none !important;
}

/* Theme-aware tokens for the error component */
:where(.reverse-engineer-gui) {
  --re-err-text:  color-mix(in oklab, var(--re-text) 60%, var(--re-danger-700) 40%);
  --re-err-border: color-mix(in oklab, var(--re-danger) 55%, var(--re-border) 45%);
  --re-err-bg:    color-mix(in oklab, var(--re-surface) 86%, var(--re-danger) 14%);
  --re-err-ring:  color-mix(in oklab, var(--re-danger) 35%, transparent);
}

/* Error box */
.re-file-error {
  display: grid;
  grid-template-columns: 20px 1fr;
  gap: .5rem .65rem;
  align-items: start;

  padding: .625rem .75rem;
  border-radius: .5rem;
  border: 1px solid var(--re-err-border);
  background: var(--re-err-bg);
  color: var(--re-err-text);

  /* small entrance pop when revealed */
  animation: re-err-in .16s ease-out both;
}

/* Decorative icon with no extra markup */
.re-file-error::before {
  content: "!";
  display: inline-grid;
  place-items: center;
  width: 20px; height: 20px;
  margin-top: 2px;

  font-weight: 800;
  font-size: 12px;
  line-height: 1;
  color: #fff;

  background: var(--re-danger);
  border: 1px solid color-mix(in oklab, var(--re-danger-700) 70%, var(--re-danger) 30%);
  border-radius: 50%;
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--re-danger) 20%, transparent);
}

/* Links inside errors (if any) */
.re-file-error a {
  color: color-mix(in oklab, var(--re-danger-700) 65%, var(--re-accent) 35%);
  text-decoration: underline;
}

/* Strong text within error */
.re-file-error strong {
  color: color-mix(in oklab, var(--re-text) 70%, var(--re-danger-700) 30%);
}

/* Optional: emphasize the drop zone when error is present */
.re-file-zone.is-error {
  border-color: var(--re-danger);
  box-shadow: 0 0 0 3px var(--re-err-ring);
}

/* Entrance animation */
@keyframes re-err-in {
  from {
    opacity: 0;
    transform: translateY(-2px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ======= Progress Bar ======= */
:where(.reverse-engineer-gui) {
  /* Sizing & shape */
  --re-progress-height: 6px;
  --re-progress-radius: 4px;

  /* Track: subtle, works in light and dark */
  --re-progress-track-bg: color-mix(in oklab, var(--re-text) 18%, transparent);

  /* Bar: emerald gradient matching this theme */
  --re-progress-bar-bg: linear-gradient(
    90deg,
    var(--re-accent) 0%,
    var(--re-accent-strong) 50%,
    var(--re-ok) 100%
  );

  /* Smooth width update (JS sets width %) */
  --re-progress-transition: width .12s ease;
}

/* If the document is in explicit light mode, soften the track a bit more */
:root[data-theme="light"] :where(.reverse-engineer-gui) {
  --re-progress-track-bg: color-mix(in oklab, var(--re-text) 12%, transparent);
}

/* If system is light and no explicit theme set, also soften */
@media (prefers-color-scheme: light) {
  :root:not([data-theme]) :where(.reverse-engineer-gui) {
    --re-progress-track-bg: color-mix(in oklab, var(--re-text) 12%, transparent);
  }
}

.re-progress-wrap {
  display: grid;
  gap: .25rem;
}

/* Respect the HTML [hidden] attribute controlled by JS */
.re-progress-wrap[hidden] {
  display: none !important;
}

.re-progress-track {
  width: 100%;
  height: var(--re-progress-height);
  background: var(--re-progress-track-bg);
  border-radius: var(--re-progress-radius);
  overflow: hidden;
}

.re-progress-bar {
  width: 0%; /* JS updates this via style.width = `${p}%` */
  height: 100%;
  background: var(--re-progress-bar-bg);
  transition: var(--re-progress-transition);
}

.re-progress-label {
  font-size: 12px;
  margin-top: .25rem;
  color: var(--re-text);
}

/* Optional states if you want different looks from JS:
   progWrap.classList.add('is-success') or 'is-error' */
.re-progress-wrap.is-success .re-progress-bar {
  background: linear-gradient(90deg, var(--re-ok), var(--re-accent-strong));
}
.re-progress-wrap.is-error .re-progress-bar {
  background: linear-gradient(90deg, var(--re-danger), var(--re-danger-700));
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .re-progress-bar {
    transition: none;
  }
}